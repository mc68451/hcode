#!/bin/bash -e
# IBM_PROLOG_BEGIN_TAG
# This is an automatically generated prolog.
#
# $Source: import/chips/p10/procedures/ppe/iop/import_iop_fw $
#
# OpenPOWER EKB Project
#
# COPYRIGHT 2019
# [+] International Business Machines Corp.
#
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
# implied. See the License for the specific language governing
# permissions and limitations under the License.
#
# IBM_PROLOG_END_TAG

# This script copies IOP firmware file to a EKB repository
#    Source directory is input by user
#    Destination directory is 'chips/p10/procedures/ppe/iop/'
#    File is renamed to 'iop.fw'
#

# IOP instruction code file path
IOP_SRC=$1
EKB_DST=${PROJECT_ROOT}/chips/p10/procedures/ppe/iop/iop.fw

echo "IOP fw source: $IOP_SRC"
echo "EKB destination: $EKB_DST"
echo ""

#
# Copy and rename file
#
echo "Importing $IOP_SRC to $EKB_DST"
cp "$IOP_SRC" "$EKB_DST"

#
# Replace all tab characters with 4 spaces
# and remove trailing white spaces
#
sed -i $'s/\t/    /g' "$EKB_DST"
sed -i 's/[ \t]*$//' "$EKB_DST"

#
# run code-beautfier and add copyright header to all copied/generated files
#
echo ""
echo "Running EKB pre-commit-actions"
echo ""
cd ${PROJECT_ROOT} && ${PROJECT_ROOT}/tools/hooks/tools/pre-commit-actions $EKB_DST
